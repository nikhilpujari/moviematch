<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>MovieMatch</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- bootstrap css -->
      <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
      <!-- style css -->
      <link rel="stylesheet" type="text/css" href="css/style.css">
      <!-- Responsive-->
      <link rel="stylesheet" href="css/responsive.css">
      <!-- fevicon -->
      <link rel="icon" href="images/fevicon.png" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
      <!-- Tweaks for older IEs-->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <!-- fonts -->
      <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&family=Sen:wght@400;700;800&display=swap" rel="stylesheet">
      <!-- owl stylesheets --> 
      <link rel="stylesheet" href="css/owl.carousel.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
      <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
   </head>
   <body>
      <!-- header section start -->
      <div class="container-fluid">
         <div class="header_section">
            <div class="container">
               <nav class="navbar navbar-light bg-light justify-content-between">
                  <div id="mySidenav" class="sidenav">
                     <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                     <a href="index.html">Home</a>
                     <a href="#movielist">Suggestions</a>
                     <a href="#news">News</a>
                     <a href="#senti">Sentiment Analysis</a>
                  </div>
                  <form class="form-inline ">
                     <div class="login_text"><a href="#"><span class="padding_left10"><img src="images/nyu.png"></span></a></div>
                  </form>
                  <a class="logo" href="index.html"><img src="images/logotop.png"></a></a>
                  <span class="toggle" onclick="openNav()"><i class="fa fa-bars"></i></span>
                  <div class="login_text"><a href="#"><i class="fa fa-envelope" aria-hidden="true"></i><span class="padding_left10">np2801@nyu.edu</span></a></div>
               </nav>
            </div>
         </div>
      </div>
      <!-- header section end -->
      <!-- layout main section start -->
      <div class="container-fluid">
         <div class="layout_main">
            <!-- banner section start -->
            <div class="banner_section">
               <div class="container">
                  <div class="menu_main">
                     <div class="custome_menu">
                        <ul>
                           <li class="active"><a href="index.html">Home</a></li>
                           <li><a href="#movielist">Suggestions</a></li>
                           <li><a href="#news">News</a></li>
                           <li><a href="#senti">Sentiment Analysis</a></li>
                        </ul>
                     </div>
                     <div class="login_menu">
                        <ul>
                           <li><a href="#">Login</a></li>
                           <li><a href="#"><i class="fa fa-search" aria-hidden="true"></i></a></li>
                        </ul>
                     </div>
                  </div>
               </div>
            <div class="container">
               <div class="row">
                  <div class="col-md-12">
                     <h1 class="banner_taital">Based on your likes and dislikes, we suggest you movies </h1>
                     <div style="text-align: center;">
                        <img src="images/logo1.png" width="50%">
                     </div>
                     
                     <h2 class="banner_text" style="font-size: 20px;">Movie Recommendation System</h2>
                     <div class="banner_main">
                        <div class="dropdown">
                           <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">All Category 
                           </button>
                           <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                              <a class="dropdown-item" href="#">Comedy</a>
                              <a class="dropdown-item" href="#">Action</a>
                              <a class="dropdown-item" href="#">Drama</a>
                           </div>
                        </div>
                        <div class="main">
                           <!-- Another variation with a button -->
                           <div class="input-group">
                              <input type="text" class="form-control" placeholder="Search">
                              <div class="input-group-append">
                                 <button class="btn btn-secondary" type="button" style="background-color: #ffffff; border-color:#ffffff ">
                                 <i class="fa fa-search" style="color: #191919;"></i>
                                 </button>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="ordernow_bt"><a href="#">Search Now</a></div>
                  </div>
               </div>
            </div>
            <!-- banner section end -->
            <!-- service section start -->
            <div class="service_section layout_padding">
               <div class="container">
                  <div class="row">
                     <div class="col-sm-12">
                        <h1 class="service_taital">Tell us your preferences</h1>
                     </div>
                  </div>
                  <div class="service_section_2" id="movielist">
                     <div class="row">
                        <div class="col" id="movie1">
                           <div class="service_box">
                              <div class="movie-poster"><img src="images/Loading.jpeg" alt="Movie Poster"></div>
                           </div>
                           <div style="text-align: center;">
                              <div class="movie-name">Movie Name</div>
                              <input type="radio" id="movie1like" name="movie1" value="like">
                              <label for="movie1like">Liked</label><br>

                              <input type="radio" id="movie1dislike" name="movie1" value="dislike">
                              <label for="movie1dislike">Disliked</label><br>

                              <input type="radio" id="movie1none" name="movie1" value="none">
                              <label for="movie1none">Unwatched</label><br>
                           </div>
                        </div>
                        <div class="col" id="movie2">
                           <div class="service_box">
                              <div class="movie-poster"><img src="images/Loading.jpeg" alt="Movie Poster"></div>
                           </div>
                           <div style="text-align: center;">
                              <div class="movie-name">Movie Name</div>
                              <input type="radio" id="movie2like" name="movie2" value="like">
                              <label for="movie2like">Liked</label><br>

                              <input type="radio" id="movie2dislike" name="movie2" value="dislike">
                              <label for="movie2dislike">Disliked</label><br>

                              <input type="radio" id="movie2none" name="movie2" value="none">
                              <label for="movie2none">Unwatched</label><br>
                           </div>
                        </div>
                        <div class="col" id="movie3">
                           <div class="service_box" >
                              <div class="movie-poster"><img src="images/Loading.jpeg" alt="Movie Poster"></div>
                           </div>
                           <div style="text-align: center;">
                              <div class="movie-name">Movie Name</div>
                              <input type="radio" id="movie3like" name="movie3" value="like">
                              <label for="movie3like">Liked</label><br>

                              <input type="radio" id="movie3dislike" name="movie3" value="dislike">
                              <label for="movie3dislike">Disliked</label><br>

                              <input type="radio" id="movie3none" name="movie3" value="none">
                              <label for="movie3none">Unwatched</label><br>
                           </div>
                        </div>
                        <div class="col" id="movie4">
                           <div class="service_box">
                              <div class="movie-poster"><img src="images/Loading.jpeg" alt="Movie Poster"></div>
                           </div>
                           <div style="text-align: center;">
                              <div class="movie-name">Movie Name</div>
                              <input type="radio" id="movie4like" name="movie4" value="like">
                              <label for="movie4like">Liked</label><br>

                              <input type="radio" id="movie4dislike" name="movie4" value="dislike">
                              <label for="movie4dislike">Disliked</label><br>

                              <input type="radio" id="movie4none" name="movie4" value="none">
                              <label for="movie4none">Unwatched</label><br>
                           </div>
                        </div>
                        <div class="col" id="movie5">
                           <div class="service_box">
                              <div class="movie-poster"><img src="images/Loading.jpeg" alt="Movie Poster"></div>
                           </div>
                           <div style="text-align: center;">
                              <div class="movie-name">Movie Name</div>
                              <input type="radio" id="movie5like" name="movie5" value="like">
                              <label for="movie5like">Liked</label><br>

                              <input type="radio" id="movie5dislike" name="movie5" value="dislike">
                              <label for="movie5dislike">Disliked</label><br>

                              <input type="radio" id="movie5none" name="movie5" value="none">
                              <label for="movie5none">Unwatched</label><br>
                           </div>
                        </div>
                        <div class="col" id="movie6" >
                           <div class="service_box">
                              <div class="movie-poster"><img src="images/Loading.jpeg" alt="Movie Poster"></div>
                           </div>
                           
                           <div style="text-align: center;">
                              <div class="movie-name">Movie Name</div>
                              <input type="radio" id="movie6like" name="movie6" value="like">
                              <label for="movie6like">Liked</label><br>

                              <input type="radio" id="movie6dislike" name="movie6" value="dislike">
                              <label for="movie6dislike">Disliked</label><br>

                              <input type="radio" id="movie6none" name="movie6" value="none">
                              <label for="movie6none">Unwatched</label><br>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="ordernow_bt"><a href="#" onclick="submitVotes(); return false;">Get Suggestions</a></div>
            </div>
            <br>            
            <div class="service_section layout_padding" id="recommendation" style="display: none;">
               <div class="container">
                  <div class="row">
                     <div class="col-sm-12">
                        <h1 class="service_taital">We recommend you to watch</h1>
                     </div>
                  </div>
                  <div class="service_section_2" id="recommendation">
                   
                  </div>
               </div>
            </div>

            <!-- contact section start -->
            <div class="contact_section layout_padding" id="senti">
               <div class="container">
                  <div class="contact_section_2">
                     <div class="row">
                        <div class="col-md-12">
                           <h1 class="contact_taital">Sentiment Analysis</h1>
                           <div id="sentimentTable">
                           </div>
                        </div>
                     </div>
                     <div class="order_section">
                        <div class="order_taital_main">
                           <h1 class="order_taital">Confusion Matrix</h1>
                           <img src="images/senti.png" width="60%">
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <!-- contact section end -->
            <!-- footer section start -->
            <div class="footer_section">
               <div class="container">
                  <div class="footer_sectio_2">
                     <div class="row">
                        <div class="col-lg-3 col-md-6">
                           <h2 class="footer_logo">MOVIEMATCH</h2>
                           <p class="footer_text">We suggest you movies based on your choices with the help of Machine Learing </p>
                        </div>
                        <div class="col-lg-3 col-md-6">
                           <h2 class="useful_text">Navigation</h2>
                           <div class="footer_menu">
                              <ul>
                                 <li class="active"><a href="index.html">Home</a></li>
                                 <li><a href="about.html">Suggestions</a></li>
                                 <li><a href="location.html">News</a></li>
                                 <li><a href="service.html">Sentiment Analysis</a></li>
                              </ul>
                           </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                           <h2 class="useful_text">Student Info</h2>
                           <p class="address_text">Net ID</p>
                           <div class="map_icon"><a href="#"><span class="padding_left15">np2801</span></a></div>
                           <p class="address_text">Name:</p>
                           <div class="map_icon"><a href="#"><span class="padding_left15">Nikhil Pujari</span></a></div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                           <h2 class="useful_text">Course</h2>
                           <p class="address_text">Database System</p>
                           <p class="address_text">CS-GA.2433-001</p>
                           <p class="address_text">By Prof. Jean-Claude Franchitti</p>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <!-- footer section end -->
         </div>
      </div>
      <!-- layout main section end -->
      <!-- copyright section start -->
      <div class="copyright_section">
         <div class="container">
            <p class="copyright_text">2023 Final DBS Project by <a href="https://www.nikhilpujari.in">Nikhil Pujari </a>for CS-GA.2433-001 </a></p>
         </div>
      </div>
      <!-- copyright section end -->
      <!-- Javascript files-->
      <script src="js/jquery.min.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.bundle.min.js"></script>
      <script src="js/jquery-3.0.0.min.js"></script>
      <script src="js/plugin.js"></script>
      <!-- sidebar -->
      <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
      <script src="js/custom.js"></script>
      <!-- javascript --> 
      <script src="js/owl.carousel.js"></script>
      <script src="https:cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>  
      <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
      <script>
         function openNav() {
           document.getElementById("mySidenav").style.width = "100%";
         }
         
         function closeNav() {
           document.getElementById("mySidenav").style.width = "0";
         }
      </script> 
      <script>
         function fetchMovies() {
            $.ajax({
               url: 'fetchMovies.php',
               type: 'GET',
               dataType: 'json',
               success: function(response) {
                  console.log(response);
                  if (response && Array.isArray(response)) {
                     // Iterate through the response and update the corresponding movie elements
                     response.forEach(function(movie, index) {
                        // Update movie1, movie2, etc.
                        updateMovieDisplay(index + 1, movie.id, movie.name, movie.posterUrl);
                     });
                  }
               },
               error: function(xhr, status, error) {
                     console.error("Error fetching movies: ", status, error);
               }
            });
         }




      function updateMovieDisplay(movieIndex, movieID, movieName, posterUrl) {
         var movieContainer = document.getElementById('movie' + movieIndex);
         if (movieContainer) {
            movieContainer.setAttribute('data-movie-id', movieID);
            var imgDiv = movieContainer.querySelector('.movie-poster img');
            if (imgDiv) {
                  imgDiv.src = posterUrl;
                  // Set onerror attribute to change the src to a default poster if an error occurs
                  imgDiv.onerror = function() {
                     this.src = 'images/PosterNotFound.jpeg'; // Replace with your default poster URL
                  };
            }

            var nameDiv = movieContainer.querySelector('.movie-name');
            if (nameDiv) nameDiv.textContent = movieName;
         }
      }

      window.onload = fetchMovies;
      </script>
      <script>
         function submitVotes() {
            let votes = [];

            // Iterate over each movie container
            document.querySelectorAll('.col').forEach((movieElement, index) => {
               let movieId = movieElement.getAttribute('data-movie-id');
               let i = index + 1; 
               let voteElement = movieElement.querySelector(`input[name="movie${i}"]:checked`);
               let voteValue = voteElement ? voteElement.value : null;

               if (voteValue) {
                     // Extract the last part of the value to get 'like', 'dislike' or 'none'
                     let vote = voteValue.replace(movieElement.id, '');

                     votes.push({ movieId, vote });
                    
               }
            });

            // Send the votes to the server
            fetch('submitVotes.php', {
               method: 'POST',
               headers: {
                     'Content-Type': 'application/json',
               },
               body: JSON.stringify(votes),
            })
            .then(response => response.json())
            .then(data => {
               console.log('Success:', data);
            })
            .catch((error) => {
               console.error('Error:', error);
            });
         }

      </script>

      <script>
      // Assume this function is called when you need to display recommendations
      function fetchAndDisplayRecommendations() {
      $.ajax({
         url: 'getSuggestion.php', 
         type: 'GET', 
         dataType: 'json', 
         success: function(response) {
            // Fetch the CSV file from Google Cloud Storage
            $.ajax({
            url: 'https://storage.googleapis.com/movie-datalake/MovieGenre.csv', 
            type: 'GET',
            success: function(csvData) {
               // Parse the CSV data
               var moviesData = Papa.parse(csvData, { header: true }).data;

               // Process the recommendations and display them
               processRecommendations(response, moviesData);
            },
            error: function(error) {
               console.error('Error fetching CSV:', error);
            }
            });
         },
         error: function(error) {
            console.error('Error fetching recommendations:', error);
         }
      });
      }

      // Function to process recommendations and update HTML
      function processRecommendations(movieTitles, moviesData) {
      var recommendationDiv = $('#recommendation .service_section_2');
      recommendationDiv.empty(); // Clear any existing content

      // Iterate through each movie title in the response
      movieTitles.forEach(function(movieTitle) {
         // Find the corresponding movie data in the CSV data
         var movieData = moviesData.find(function(data) {
            return data.Title.trim() === movieTitle.trim();
         });

         if (movieData && movieData.Poster) {
            // Create the HTML for each movie recommendation
            var movieHtml = `
            <div class="row">
               <div class="col">
                  <div class="service_box">
                  <div class="movie-poster"><img src="${movieData.Poster}" alt="Movie Poster"></div>
                  </div>
                  <div style="text-align: center;">
                  <div class="movie-name">${movieTitle}</div>
                  </div>
               </div>
            </div>
            `;
            // Append the movie HTML to the recommendation div
            recommendationDiv.append(movieHtml);
         }
      });

      // Show the recommendation section if it was previously hidden
      $('#recommendation').show();
      }


      </script>
      <script>
         document.addEventListener('DOMContentLoaded', function() {
               loadNews();
         });
         
         function loadNews() {
               $.ajax({
                  url: 'loadNews.php', 
                  type: 'GET',
                  dataType: 'json',
                  success: function(response) {
                  console.log(response);
                  response.forEach(function(newsItem) {
                        // Create the HTML for each news item
                        let newsHTML = `
                           <div class="col-md-3">
                              <div class="blog_img"><img src="${newsItem.img_link}"></div>
                           </div>
                           <div class="col-md-9">
                              <div class="blog_taital_main">
                                    <h2 class="blog_text">${newsItem.title}</h2>
                                    <p class="lorem_text">${newsItem.description}</p>
                              </div>
                           </div>
                        `;
                        // Append the news item to the container
                        $('#news-container').append(newsHTML);
                     });
                  },
                  error: function(jqXHR, textStatus, errorThrown) {
                     console.log('Error loading news:', textStatus, errorThrown);
                  }
               });
         }
         </script>
         <script>
            // Function to display =sentimal analysis
            function fetchClassificationReport() {
            $.ajax({
               url: 'getTable.php',
               type: 'GET', 
               dataType: 'json', 
               success: function(response) {
                  displayClassificationReport(response);
               },
               error: function(error) {
                  console.error('Error fetching classification report:', error);
               }
            });
            }

            // Function to create and display the table using the response from the Python script
            function displayClassificationReport(report) {
            let tableHtml = `
               <table border="1" class="dataframe">
                  <thead>
                  <tr style="text-align: right;">
                     <th></th>
                     <th>precision</th>
                     <th>recall</th>
                     <th>f1-score</th>
                     <th>support</th>
                  </tr>
                  </thead>
                  <tbody>
            `;

            // Add rows for each class or category
            Object.keys(report).forEach(key => {
               const values = report[key];
               tableHtml += `
                  <tr>
                  <td>${key}</td>
                  <td>${values.precision ?? ''}</td>
                  <td>${values.recall ?? ''}</td>
                  <td>${values['f1-score'] ?? ''}</td>
                  <td>${values.support ?? ''}</td>
                  </tr>
               `;
            });

            // Close the table tags
            tableHtml += `
                  </tbody>
               </table>
            `;

            // Insert the table into the container div
            const containerDiv = document.querySelector('#sentimentTable'); 
            containerDiv.innerHTML = tableHtml;

            }

            fetchClassificationReport();
         </script>
   </body>
</html>